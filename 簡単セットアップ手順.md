# 簡単セットアップ手順

## 問題
「Add Hours」ボタンを押すと「User not found」というエラーが出ます。
これは、Firebase認証でログインしたユーザーが、データベース（Prisma）に登録されていないためです。

## 解決方法（3ステップ）

### ステップ1: Firebaseの設定ファイルを取得する

1. ブラウザで https://console.firebase.google.com/ を開く
2. あなたのプロジェクトを選択
3. 左側のメニューから「⚙️ プロジェクトの設定」をクリック
4. 上のタブから「サービスアカウント」をクリック
5. 「新しい秘密鍵の生成」というボタンをクリック
6. 警告が出たら「キーを生成」をクリック
7. JSONファイルがダウンロードされます（例: `your-project-firebase-adminsdk-xxxxx.json`）

### ステップ2: 環境変数を設定する

1. ダウンロードしたJSONファイルを開く（テキストエディタで）
2. ファイルの中身をすべてコピー（Ctrl+C または Cmd+C）
3. プロジェクトのフォルダ（MXVA）に `.env.local` というファイルを作成
   - もし既に存在する場合は、そのファイルを開く
4. 以下のように追加（または既存の内容の下に追加）：

```
FIREBASE_SERVICE_ACCOUNT_KEY='[ここにコピーしたJSONの内容を貼り付け]'
```

**重要**: 
- JSONの内容をシングルクォート（'）で囲む
- 例: `FIREBASE_SERVICE_ACCOUNT_KEY='{"type":"service_account","project_id":"my-project",...}'`

### ステップ3: スクリプトを実行する

1. ターミナル（コマンドプロンプト）を開く
2. プロジェクトのフォルダに移動：
   ```bash
   cd /Users/nctakahiroyoda/Documents/programs/MXVA
   ```
3. 以下のコマンドを実行：
   ```bash
   node scripts/sync-firebase-to-prisma.js
   ```
4. 成功すると、以下のようなメッセージが表示されます：
   ```
   ✅ Firebase Admin SDK initialized
   ✅ X人のFirebaseユーザーが見つかりました
   ✅ ユーザーを作成: user@example.com
   === 同期完了 ===
   ```

### ステップ4: 開発サーバーを再起動する

1. 開発サーバーが動いている場合は、一度停止（Ctrl+C）
2. 再度起動：
   ```bash
   npm run dev
   ```

## これで完了！

「Add Hours」ボタンを押して、エラーが出ないか確認してください。

---

## もしエラーが出た場合

### エラー: "FIREBASE_SERVICE_ACCOUNT_KEY環境変数が設定されていません"
→ ステップ2を確認してください。`.env.local`ファイルに正しく設定されているか確認。

### エラー: "Cannot find module 'firebase-admin'"
→ 以下のコマンドを実行：
```bash
npm install firebase-admin
```

### エラー: "Prisma Client is not configured"
→ 以下のコマンドを実行：
```bash
npx prisma generate
```

---

## もっと簡単な方法（手動でユーザーを作成）

もし上記の方法が難しい場合は、Prisma Studioを使って手動でユーザーを作成できます：

1. ターミナルで以下を実行：
   ```bash
   npx prisma studio
   ```
2. ブラウザで http://localhost:5555 が開きます
3. 「User」テーブルをクリック
4. 「Add record」ボタンをクリック
5. 以下の情報を入力：
   - `email`: Firebase認証で使っているメールアドレス
   - `infiniteFlightUsername`: ユーザー名（任意）
   - `passwordHash`: 適当な文字列（例: `$2a$10$placeholder`）
   - `role`: `user`
6. 「Save 1 change」をクリック

これで完了です！

